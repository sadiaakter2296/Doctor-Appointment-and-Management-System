<!DOCTYPE html>
<html>
<head>
    <title>Doctor Management Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; }
        .error { color: red; }
        .success { color: green; }
        input, textarea, select { padding: 8px; margin: 5px; width: 200px; border: 1px solid #ddd; border-radius: 4px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        textarea { width: 200px; height: 60px; }
    </style>
</head>
<body>
    <h1>Doctor Management System Test</h1>
    
    <div class="section">
        <h2>Backend Status</h2>
        <button onclick="checkBackendStatus()">Check Backend Status</button>
        <div id="statusResult"></div>
    </div>

    <div class="section">
        <h2>Add New Doctor</h2>
        <div class="form-grid">
            <div>
                <label>Name: <input type="text" id="doctorName" value="Dr. John Smith" required></label>
                <label>Email: <input type="email" id="doctorEmail" value="john.smith@hospital.com" required></label>
                <label>Phone: <input type="text" id="doctorPhone" value="1234567890" required></label>
                <label>Specialty: 
                    <select id="doctorSpecialty">
                        <option value="Cardiology">Cardiology</option>
                        <option value="Dermatology">Dermatology</option>
                        <option value="Neurology">Neurology</option>
                        <option value="Pediatrics">Pediatrics</option>
                        <option value="Orthopedics">Orthopedics</option>
                    </select>
                </label>
            </div>
            <div>
                <label>Education: <textarea id="doctorEducation">MD from Harvard Medical School</textarea></label>
                <label>Experience (years): <input type="number" id="doctorExperience" value="10" required></label>
                <label>Fee: <input type="number" id="doctorFee" value="200" required></label>
                <label>Location: <input type="text" id="doctorLocation" value="New York, NY" required></label>
            </div>
        </div>
        <label>About: <textarea id="doctorAbout" style="width: 400px;">Experienced cardiologist with 10+ years of practice.</textarea></label>
        <br>
        <button onclick="addDoctor()">Add Doctor</button>
        <div id="addDoctorResult"></div>
    </div>

    <div class="section">
        <h2>All Doctors</h2>
        <button onclick="getAllDoctors()">Get All Doctors</button>
        <button onclick="clearDoctors()">Clear Doctors List</button>
        <div id="doctorsResult"></div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000/api';

        async function checkBackendStatus() {
            try {
                const response = await fetch(`${API_BASE}/doctors`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    document.getElementById('statusResult').innerHTML = 
                        '<div class="success">✅ Backend is running and responding!</div>';
                } else {
                    document.getElementById('statusResult').innerHTML = 
                        '<div class="error">❌ Backend responded with error: ' + response.status + '</div>';
                }
            } catch (error) {
                document.getElementById('statusResult').innerHTML = 
                    '<div class="error">❌ Cannot connect to backend: ' + error.message + '</div>';
            }
        }

        async function addDoctor() {
            const doctorData = {
                name: document.getElementById('doctorName').value,
                email: document.getElementById('doctorEmail').value,
                phone: document.getElementById('doctorPhone').value,
                specialty: document.getElementById('doctorSpecialty').value,
                education: document.getElementById('doctorEducation').value,
                experience: parseInt(document.getElementById('doctorExperience').value),
                fee: parseFloat(document.getElementById('doctorFee').value),
                location: document.getElementById('doctorLocation').value,
                about: document.getElementById('doctorAbout').value,
                status: 'Available',
                languages: ['English'],
                working_hours: {
                    monday: { start: '09:00', end: '17:00' },
                    tuesday: { start: '09:00', end: '17:00' },
                    wednesday: { start: '09:00', end: '17:00' },
                    thursday: { start: '09:00', end: '17:00' },
                    friday: { start: '09:00', end: '17:00' },
                    saturday: { start: '09:00', end: '14:00' },
                    sunday: { start: 'closed', end: 'closed' }
                }
            };

            try {
                console.log('Sending doctor data:', doctorData);
                
                const response = await fetch(`${API_BASE}/doctors`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(doctorData)
                });

                const result = await response.json();
                console.log('Response:', result);

                if (response.ok) {
                    document.getElementById('addDoctorResult').innerHTML = 
                        '<div class="success"><h3>✅ Doctor Added Successfully!</h3><pre>' + 
                        JSON.stringify(result, null, 2) + '</pre></div>';
                    
                    // Clear form
                    document.getElementById('doctorName').value = '';
                    document.getElementById('doctorEmail').value = '';
                    document.getElementById('doctorPhone').value = '';
                    document.getElementById('doctorEducation').value = '';
                    document.getElementById('doctorExperience').value = '';
                    document.getElementById('doctorFee').value = '';
                    document.getElementById('doctorLocation').value = '';
                    document.getElementById('doctorAbout').value = '';
                    
                    // Automatically refresh the doctors list
                    getAllDoctors();
                } else {
                    document.getElementById('addDoctorResult').innerHTML = 
                        '<div class="error"><h3>❌ Failed to Add Doctor!</h3><pre>' + 
                        JSON.stringify(result, null, 2) + '</pre></div>';
                }
            } catch (error) {
                document.getElementById('addDoctorResult').innerHTML = 
                    '<div class="error"><h3>❌ Network Error!</h3><pre>' + error.message + '</pre></div>';
            }
        }

        async function getAllDoctors() {
            try {
                const response = await fetch(`${API_BASE}/doctors`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('Doctors response:', result);

                if (response.ok) {
                    const doctors = result.data || result;
                    if (doctors && doctors.length > 0) {
                        let doctorsHtml = '<h3>✅ Doctors in Database (' + doctors.length + '):</h3>';
                        doctorsHtml += '<div style="display: grid; gap: 10px;">';
                        
                        doctors.forEach(doctor => {
                            doctorsHtml += `
                                <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; background: #f9f9f9;">
                                    <h4>${doctor.name}</h4>
                                    <p><strong>Email:</strong> ${doctor.email}</p>
                                    <p><strong>Specialty:</strong> ${doctor.specialty}</p>
                                    <p><strong>Experience:</strong> ${doctor.experience} years</p>
                                    <p><strong>Fee:</strong> $${doctor.fee}</p>
                                    <p><strong>Location:</strong> ${doctor.location}</p>
                                    <p><strong>Status:</strong> ${doctor.status}</p>
                                    <small><strong>Created:</strong> ${doctor.created_at}</small>
                                </div>
                            `;
                        });
                        doctorsHtml += '</div>';
                        document.getElementById('doctorsResult').innerHTML = doctorsHtml;
                    } else {
                        document.getElementById('doctorsResult').innerHTML = 
                            '<div class="success">✅ No doctors found in database yet.</div>';
                    }
                } else {
                    document.getElementById('doctorsResult').innerHTML = 
                        '<div class="error"><h3>❌ Failed to Get Doctors!</h3><pre>' + 
                        JSON.stringify(result, null, 2) + '</pre></div>';
                }
            } catch (error) {
                document.getElementById('doctorsResult').innerHTML = 
                    '<div class="error"><h3>❌ Network Error!</h3><pre>' + error.message + '</pre></div>';
            }
        }

        function clearDoctors() {
            document.getElementById('doctorsResult').innerHTML = '';
        }

        // Auto-check backend status on page load
        window.onload = function() {
            checkBackendStatus();
            getAllDoctors();
        };
    </script>
</body>
</html>
